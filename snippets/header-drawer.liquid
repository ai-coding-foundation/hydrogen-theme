{%- doc -%}
  Displays a header drawer menu for mobile.
  Renders top-level links as expandable groups; child links are nested
  inside collapsible <details> elements for progressive enhancement.

  @param {string} shopify_attributes
  @param {linklist} linklist
{%- enddoc -%}

<header-drawer client:media="(max-width: 1023px)" {{ shopify_attributes }}>
  <details>
    <summary
      class="h-8 w-8 [.menu-opening_&]:before:absolute [.menu-opening_&]:before:inset-0 [.menu-opening_&]:before:h-screen [.menu-opening_&]:before:bg-black/25 [.no-js_details[open]_&]:absolute [.no-js_details[open]_&]:left-1/2 [.no-js_details[open]_&]:z-50 [.no-js_details[open]_&]:-translate-x-1/2 [.no-js_details[open]_&]:-translate-y-1/2"
      aria-haspopup="dialog"
      aria-label="{{ 'sections.header.menu' | t }}"
    >
      <span class="flex h-full w-full items-center justify-center [.no-js_details[open]_&]:hidden">
        {% render 'icon-menu' %}
      </span>
      <span class="hidden h-full w-full items-center justify-center [.no-js_details[open]_&]:flex">
        {%- render 'icon-close' -%}
      </span>
    </summary>
    <div
      id="menu-drawer"
      class="bg-contrast fixed inset-0 z-20 h-screen max-w-lg overflow-y-auto [.js_&]:-translate-x-full [.js_&]:transition [.js_&]:duration-300 [.js_.menu-opening_&]:translate-x-0"
      role="dialog"
      aria-modal="true"
      aria-label="{{ 'sections.header.menu' | t }}"
      tabindex="-1"
    >
      <div class="h-nav flex items-center justify-between px-6 sm:px-8 md:px-12">
        <h2 class="text-lead font-body-weight-bold max-w-prose">{{ 'sections.header.menu' | t }}</h2>
        <button
          type="button"
          class="text-primary hover:text-primary/50 -m-4 p-4 transition [.no-js_details[open]_&]:hidden"
          aria-label="{{ 'accessibility.close' | t }}"
        >
          {%- render 'icon-close' -%}
        </button>
      </div>
      <nav class="after:h-nav grid gap-2 px-6 py-6 after:block after:content-[''] sm:px-12 sm:py-8">
        {%- for link in linklist.links -%}
          {%- if link.links.size > 0 -%}
            <details class="border-primary/10 group border-b pb-2">
              <summary class="font-heading text-copy text-primary flex cursor-pointer list-none items-center justify-between py-2 [&::-webkit-details-marker]:hidden">
                <span>{{ link.title | escape }}</span>
                <span class="transition duration-200 group-open:rotate-180">
                  {%- render 'icon-caret' -%}
                </span>
              </summary>
              {%- assign parent_lower = link.title | downcase -%}
              {%- assign handle_lower = link.handle | downcase -%}
              {%- assign is_explore = false -%}
              {%- if parent_lower contains 'explore' or handle_lower contains 'explore' -%}
                {%- assign is_explore = true -%}
              {%- endif -%}
              <ul class="grid gap-1 pb-2 pl-4">
                {%- for child in link.links -%}
                  <li>
                    {%- if is_explore -%}
                      {%- render 'nav-stage-link', link: child, link_class: 'block py-1.5' -%}
                    {%- else -%}
                      <a
                        href="{{ child.url }}"
                        class="text-copy text-primary/80 hover:text-primary block py-1.5 transition"
                        {% if child.current %}
                          aria-current="page"
                        {% endif %}
                      >
                        {{ child.title | escape }}
                      </a>
                    {%- endif -%}
                  </li>
                {%- endfor -%}
              </ul>
            </details>
          {%- else -%}
            <a
              href="{{ link.url }}"
              class="font-heading text-copy text-primary border-primary/10 border-b py-2 transition"
              {% if link.current %}
                aria-current="page"
              {% endif %}
            >
              {{ link.title | escape }}
            </a>
          {%- endif -%}
        {%- endfor -%}
      </nav>
    </div>
  </details>
</header-drawer>
