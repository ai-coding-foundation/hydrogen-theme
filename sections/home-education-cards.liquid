{%- liquid
  assign loading = 'lazy'
  assign fetchpriority = 'auto'
-%}

<div
  id="HomeEducationCards-{{ section.id }}"
  class="bg-contrast w-full py-16 md:py-24"
>
  <div class="mx-auto max-w-7xl px-6 md:px-8">
    {%- comment -%} Section heading centered {%- endcomment -%}
    {%- if section.settings.heading != blank -%}
      <header class="mx-auto mb-12 max-w-3xl text-center md:mb-16">
        {%- assign heading_tag = section.settings.heading_level -%}
        <{{ heading_tag }} class="text-h2 font-heading font-heading-weight text-primary">
          {{ section.settings.heading | escape }}
        </{{ heading_tag }}>
      </header>
    {%- endif -%}

    {%- comment -%} Card grid {%- endcomment -%}
    <div class="grid grid-cols-1 gap-8 md:grid-cols-3">
      {%- for block in section.blocks -%}
        {%- if block.type == 'card' -%}
          <article
            class="bg-contrast border-primary/8 group overflow-hidden rounded-lg border transition-shadow duration-300 hover:-translate-y-0.5 hover:shadow-lg"
            {{ block.shopify_attributes }}
          >
            {%- if block.settings.url != blank -%}
              <a href="{{ block.settings.url }}" class="block">
            {%- endif -%}

            {%- comment -%} Card image {%- endcomment -%}
            <div class="relative aspect-[4/3] overflow-hidden rounded-t-lg">
              {%- if block.settings.image != blank -%}
                {%- liquid
                  assign img = block.settings.image
                  assign img_height = img.width | divided_by: img.aspect_ratio
                  assign img_alt = block.settings.title | default: 'Education card' | escape
                -%}
                {{
                  img
                  | image_url: width: 800
                  | image_tag:
                    loading: loading,
                    fetchpriority: fetchpriority,
                    width: img.width,
                    height: img_height,
                    class: 'block h-full w-full object-cover transition-transform duration-300 group-hover:scale-105',
                    sizes: '(min-width: 768px) 33vw, 100vw',
                    widths: '375, 550, 750, 800, 1100',
                    alt: img_alt
                }}
              {%- else -%}
                <div class="bg-stage-neutral flex h-full w-full items-center justify-center">
                  {{ 'product-1' | placeholder_svg_tag: 'h-24 w-24 fill-primary/20' }}
                </div>
              {%- endif -%}
            </div>

            {%- comment -%} Card content {%- endcomment -%}
            <div class="p-6 md:p-8">
              <h3 class="text-h4 font-heading font-heading-weight text-primary mb-3">
                {{ block.settings.title | escape }}
              </h3>
              {%- if block.settings.description != blank -%}
                <p class="text-copy font-body text-primary/80 mb-4">
                  {{ block.settings.description | escape }}
                </p>
              {%- endif -%}
              {%- if block.settings.url != blank -%}
                <span class="text-copy font-body text-primary hover:text-primary/80 underline underline-offset-4 transition-colors">
                  Learn more
                </span>
              {%- endif -%}
            </div>

            {%- if block.settings.url != blank -%}
              </a>
            {%- endif -%}
          </article>
        {%- endif -%}
      {%- endfor -%}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Education cards",
  "tag": "section",
  "class": "section-home-education-cards",
  "max_blocks": 4,
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Explore the science"
    },
    {
      "type": "select",
      "id": "heading_level",
      "label": "Heading level",
      "options": [
        {
          "value": "h2",
          "label": "H2"
        },
        {
          "value": "h3",
          "label": "H3"
        }
      ],
      "default": "h2"
    }
  ],
  "blocks": [
    {
      "type": "card",
      "name": "Card",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Card title"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Description",
          "default": "Card description"
        },
        {
          "type": "url",
          "id": "url",
          "label": "Link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Education cards",
      "category": "Homepage",
      "blocks": [
        {
          "type": "card",
          "settings": {
            "title": "Stage Guide",
            "description": "Discover what your body needs at every stage"
          }
        },
        {
          "type": "card",
          "settings": {
            "title": "Ingredient Glossary",
            "description": "Explore what goes into every formula and why"
          }
        },
        {
          "type": "card",
          "settings": {
            "title": "Research Hub",
            "description": "The science behind stage-specific nutrition"
          }
        }
      ]
    }
  ]
}
{% endschema %}
